# Домашнее работа  к занятию «Основы Terraform. Yandex Cloud»

### Задание 1

Переименуйте файл personal.auto.tfvars_example в personal.auto.tfvars. Заполните переменные: идентификаторы облака, токен доступа.

Сгенерируйте новый или используйте свой текущий ssh-ключ. Запишите его открытую(public) часть в переменную **vms_ssh_public_root_key**.

Инициализируйте проект, выполните код. Исправьте намеренно допущенные синтаксические ошибки. Ищите внимательно, посимвольно. Ответьте, в чём заключается их суть.

Подключитесь к консоли ВМ через ssh и выполните команду ``` curl ifconfig.me```.

Примечание: К OS ubuntu "out of a box, те из коробки" необходимо подключаться под пользователем ubuntu: ```"ssh ubuntu@vm_ip_address"```. Предварительно убедитесь, что ваш ключ добавлен в ssh-агент: ```eval $(ssh-agent) && ssh-add``` Вы познакомитесь с тем как при создании ВМ создать своего пользователя в блоке metadata в следующей лекции.;

![Инициализировал проект и исправил неточности ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/2%20%D1%83%D1%80%D0%BE%D0%BA%201%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%206%20%D0%BF%D1%83%D0%BD%D0%BA%D1%82%201%20%D1%87%D0%B0%D1%81%D1%82%D1%8C.png)
![подключение и команла curl ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/2%20%D1%83%D1%80%D0%BE%D0%BA%201%20%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%206%20%D0%BF%D1%83%D0%BD%D0%BA%D1%82.png)


Ответьте, как в процессе обучения могут пригодиться параметры ```preemptible = true``` и ```core_fraction=5``` в параметрах ВМ.
```preemptible = true``` - прерываемая виртуальная машина, позволяет создать машину на которой можно прервать работу(экономит ресурсы промокода) 
```core_fraction=5``` - уровень производительности vCPU, логически занимаем производительность CPU, т.к использование 100% нам не нужно. Пока не запускаем в нем ввысоконагруженое приложение.

### Задание 2


1. Изучите файлы проекта.
2. Замените все хардкод-**значения** для ресурсов **yandex_compute_image** и **yandex_compute_instance** на **отдельные** переменные. К названиям переменных ВМ добавьте в начало префикс **vm_web_** .  Пример: **vm_web_name**.
2. Объявите нужные переменные в файле variables.tf, обязательно указывайте тип переменной. Заполните их **default** прежними значениями из main.tf. 
3. Проверьте terraform plan. Изменений быть не должно.

![замена всего хардкода и проверка планом  ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%202%20%D0%B7%D0%B0%D0%BC%D0%B5%D0%BD%D0%B0%20%D1%85%D0%B0%D1%80%D0%B4%D0%BA%D0%BE%D0%B4%D0%B0.png)


### Задание 3

1. Создайте в корне проекта файл 'vms_platform.tf' . Перенесите в него все переменные первой ВМ.
2. Скопируйте блок ресурса и создайте с его помощью вторую ВМ в файле main.tf: **"netology-develop-platform-db"** ,  ```cores  = 2, memory = 2, core_fraction = 20```. Объявите её переменные с префиксом **vm_db_** в том же файле ('vms_platform.tf').
3. Примените изменения.

Примечание. В этом задании не понял какие блоки ресурса нужнужно было создать. 

![замена всего хардкода и проверка планом  ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%203%20%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%92%D0%9C%20%D0%94%D0%91.png)


### Задание 4

1. Объявите в файле outputs.tf **один** output типа **map**, содержащий { instance_name = external_ip } для каждой из ВМ.
2. Примените изменения.

В качестве решения приложите вывод значений ip-адресов команды ```terraform output```.

![вывод output  ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/outputs%20vscode.png)

### Задание 5

1. В файле locals.tf опишите в **одном** local-блоке имя каждой ВМ, используйте интерполяцию ${..} с несколькими переменными по примеру из лекции.
2. Замените переменные с именами ВМ из файла variables.tf на созданные вами local-переменные.
3. Примените изменения.
![ замена имени локал переменными  ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BF%D0%BE%D0%BB%D1%8F%D1%86%D0%B8%D1%8F%20locals.png)

### Задание 6

1. Вместо использования трёх переменных  ".._cores",".._memory",".._core_fraction" в блоке  resources {...}, объедините их в единую map-переменную **vms_resources** и  внутри неё конфиги обеих ВМ в виде вложенного map.

2. Создайте и используйте отдельную map переменную для блока metadata, она должна быть общая для всех ваших ВМ.

3. Найдите и закоментируйте все, более не используемые переменные проекта.
4. Проверьте terraform plan. Изменений быть не должно.

![ замена имени локал переменными  ](https://github.com/chinchanchonTom/devops-netology/blob/main/terraform_02/ssh%20key%20locals.png)
















